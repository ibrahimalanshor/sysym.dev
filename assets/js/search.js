const input=document.querySelector("#search"),resultInfo=document.querySelector("#result-info"),resultPosts=document.querySelector("#result-posts");let lunrIndex,q="",postByTitle={},res=[];async function loadPosts(){try{const e=await fetch("/index.json"),t=await e.json();postByTitle=Object.fromEntries(t.posts.map((e=>[e.title,e]))),lunrIndex=lunr((function(){this.ref("title"),this.field("content"),t.posts.forEach((e=>this.add(e)))}))}catch(e){}}async function setupSearch(){await loadPosts()}function performSearch(){res=lunrIndex.search(q),makeResult()}function makeResult(){resultInfo.innerHTML=`\n        <span>${res.length} Result for <b class="text-sky-900">"${q}"</b></span>\n        <hr>\n    `,resultPosts.innerHTML=res.map((e=>postByTitle[e.ref])).reduce(((e,t)=>e+=`\n                <article>\n                    <p class="flex items-center gap-x-4">\n                        <span>${t.date}</span>\n                    </p>\n                    <a href="${t.url}" class="no-underline">\n                        <h2 class="mt-0 mb-0">${t.title}</h2>\n                    </a>\n                    <p>${t.summary}</p>\n                    <a href="${t.url}">Read Full Post</a>\n                    <hr>\n                </article>\n                `),"")}input.addEventListener("input",(e=>{q=e.target.value,performSearch()})),setupSearch();